import { HorizontalBox, VerticalBox, ScrollView, TextEdit } from "std-widgets.slint";
import { Kolory } from "colors.slint";
import { DraggableWindow } from "DraggableWindow.slint";

import "../resources/fonts/Geist-Regular.otf";
import "../resources/fonts/Geist-Bold.otf";
import "../resources/fonts/GeistMono-Regular.otf";

export component ConsoleWindow inherits Rectangle {
    background: Kolory.tlo;
    border-color: Kolory.obramowanie;
    border-width: 1px;
    border-radius: 4px;
    in-out property <string> console-text: "";
    callback clear-console();
    callback exit();
    in-out property <string> window-title: "Console";
    // Wymiary kontenera i marginesy do ograniczenia ruchu
    in-out property <length> container-width: 0px;
    in-out property <length> container-height: 0px;
    in-out property <length> top-margin: 30px;
    in-out property <length> bottom-margin: 48px;

    VerticalLayout {
        padding: 4px;
        spacing: 0px;

        DraggableWindow {
            window-title: root.window-title;
            exit => { root.exit(); }
            dragged(dx, dy) => {
                // Aktualizuj pozycję okna w granicach dostępnego obszaru
                root.x = Math.max(0px, Math.min(root.container-width - root.width, root.x + dx));
                root.y = Math.max(root.top-margin, Math.min(root.container-height - root.bottom-margin - root.height, root.y + dy));
            }
            // Brak dodatkowych działań po zakończeniu przeciągania
            drag-ended => { }
        }

        ScrollView {
            vertical-stretch: 1;

            Rectangle {
                background: Kolory.panel_tlo;
                border-color: Kolory.obramowanie;
                border-width: 1px;
                width: parent.width;
                height: parent.height;

                TextEdit {
                    text: root.console-text;
                    read-only: true;
                    wrap: word-wrap;
                    font-size: 10px;
                    horizontal-alignment: left;
                    width: parent.width;
                    height: parent.height;
                }
            }
        }

        Rectangle {
            height: 32px;
            background: Kolory.panel_tlo;

            VerticalLayout {
                spacing: 0px;
                padding: 0px;

                Rectangle {
                    height: 1px;
                    background: Kolory.obramowanie;
                }

                HorizontalLayout {
                    padding: 4px;
                    spacing: 10px;
                    alignment: center;
                    vertical-stretch: 1;

                    Rectangle {
                        width: 80px;
                        height: 20px;
                        background: button1-area.has-hover ? Kolory.hover : Kolory.suwak_tlo;
                        border-color: Kolory.suwak_tor;
                        border-width: 1px;
                        border-radius: 3px;
                        Text { text: "Clear"; color: Kolory.tekst; font-size: 10px; font-family: "Geist"; horizontal-alignment: center; vertical-alignment: center; }
                        button1-area := TouchArea { clicked => { root.clear-console(); } }
                    }

                    Rectangle {
                        width: 80px;
                        height: 20px;
                        background: button2-area.has-hover ? Kolory.hover : Kolory.suwak_tlo;
                        border-color: Kolory.suwak_tor;
                        border-width: 1px;
                        border-radius: 3px;
                        Text { text: "Close"; color: Kolory.tekst; font-size: 10px; font-family: "Geist"; horizontal-alignment: center; vertical-alignment: center; }
                        button2-area := TouchArea { clicked => { root.exit(); } }
                    }
                }
            }
        }
    }
}
